<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­å•è¯é»˜å†™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        .back-home {
            position: fixed;
            top: 16px;
            left: 16px;
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 0.9em;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .back-home:hover {
            background: #fff;
        }
        
        body {
            font-family: 'Segoe UI', 'PingFang SC', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .header {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a11cb 100%);
            color: white;
            padding: 25px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .header::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: pulse 8s infinite linear;
        }
        
        @keyframes pulse {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .header h1 {
            font-size: 2.2em;
            margin-bottom: 8px;
            font-weight: 700;
            position: relative;
            z-index: 1;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
            position: relative;
            z-index: 1;
        }
        
        .control-panel {
            padding: 25px 30px;
            background: #f8f9ff;
            border-bottom: 1px solid #e6e9ff;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .range-inputs {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .range-label {
            font-weight: 600;
            color: #4a6ee0;
            white-space: nowrap;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            flex: 1;
        }
        
        .number-input {
            flex: 1;
            padding: 14px 16px;
            border: 2px solid #d1d9ff;
            border-radius: 12px;
            font-size: 1em;
            outline: none;
            transition: all 0.3s;
            background: white;
            font-weight: 500;
        }
        
        .number-input:focus {
            border-color: #4a6ee0;
            box-shadow: 0 0 0 4px rgba(74, 110, 224, 0.1);
        }
        
        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a11cb 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f2ff;
            color: #4a6ee0;
            border: 2px solid #d1d9ff;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 7px 15px rgba(0,0,0,0.1);
        }
        
        .btn:active {
            transform: translateY(-1px);
        }
        
        .content {
            padding: 30px;
        }
        
        .word-card {
            background: linear-gradient(135deg, #f8f9ff 0%, #ffffff 100%);
            border-radius: 16px;
            padding: 35px;
            margin-bottom: 25px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            border: 1px solid #e6e9ff;
            position: relative;
            overflow: hidden;
        }
        
        .word-card::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: linear-gradient(to bottom, #4a6ee0, #6a11cb);
        }
        
        .chinese-info {
            font-size: 2.2em;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 15px;
            line-height: 1.3;
            text-align: center;
        }
        
        .pronounce-info {
            color: #7f8c8d;
            font-style: italic;
            font-size: 1.3em;
            margin-bottom: 20px;
            text-align: center;
            font-weight: 500;
        }
        
        .word-info {
            color: #2c3e50;
            font-size: 1.8em;
            line-height: 1.6;
            padding: 20px;
            background: rgba(74, 110, 224, 0.05);
            border-radius: 12px;
            border-left: 4px solid #4a6ee0;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 700;
            margin-top: 10px;
        }
        
        .word-info.show {
            opacity: 1;
            height: auto;
            padding: 20px;
        }
        
        .user-input-section {
            margin-bottom: 25px;
            position: relative;
        }
        
        .user-input {
            width: 100%;
            padding: 20px;
            border: 2px solid #d1d9ff;
            border-radius: 12px;
            font-size: 1.4em;
            outline: none;
            text-align: center;
            font-weight: 600;
            background: #f8f9ff;
            transition: all 0.3s;
            box-shadow: inset 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .user-input:focus {
            border-color: #4a6ee0;
            box-shadow: 0 0 0 4px rgba(74, 110, 224, 0.1), inset 0 2px 5px rgba(0,0,0,0.05);
            background: white;
        }
        
        .user-input::placeholder {
            color: #aab2bd;
            font-weight: 500;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 15px;
            gap: 15px;
        }
        
        .button-group {
            display: flex;
            gap: 12px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #e74c3c;
            font-size: 1.2em;
        }
        
        .index-info {
            color: #7f8c8d;
            font-size: 1em;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 500;
        }
        
        .word-count-info {
            color: #4a6ee0;
            font-weight: 700;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.1em;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 12px 16px;
            border-radius: 8px;
            font-size: 0.95em;
            display: none;
            font-weight: 500;
        }
        
        .status-success {
            background-color: #d4f5e2;
            color: #155724;
            display: block;
            border-left: 4px solid #2ecc71;
        }
        
        .status-error {
            background-color: #fde8e6;
            color: #721c24;
            display: block;
            border-left: 4px solid #e74c3c;
        }
        
        .book-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #7f8c8d;
            font-style: italic;
            text-align: center;
        }
        
        .validation-result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
            font-weight: 500;
        }
        
        .validation-correct {
            background-color: #d4f5e2;
            color: #155724;
            display: block;
            border-left: 4px solid #2ecc71;
        }
        
        .validation-incorrect {
            background-color: #fde8e6;
            color: #721c24;
            display: block;
            border-left: 4px solid #e74c3c;
        }
        
        .frequency {
            background: linear-gradient(135deg, #4a6ee0 0%, #6a11cb 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            font-size: 0.95em;
            font-weight: 600;
            display: block;
            margin: 0 auto 15px;
            box-shadow: 0 4px 10px rgba(74, 110, 224, 0.3);
            text-align: center;
        }
        
        .progress-container {
            width: 100%;
            background-color: #e6e9ff;
            border-radius: 10px;
            margin-bottom: 20px;
            overflow: hidden;
            height: 10px;
        }
        
        .progress-bar {
            height: 100%;
            background: linear-gradient(135deg, #4a6ee0 0%, #6a11cb 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: 700;
            color: #4a6ee0;
        }
        
        .hint {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 10px;
        }
        
        @media (max-width: 768px) {
            .container {
                max-width: 95%;
                border-radius: 15px;
            }
            
            .header h1 {
                font-size: 1.8em;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .button-group {
                width: 100%;
                justify-content: space-between;
            }
            
            .btn {
                flex: 1;
                padding: 12px 16px;
            }
            
            .chinese-info {
                font-size: 1.8em;
            }
            
            .user-input {
                font-size: 1.2em;
                padding: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .header {
                padding: 20px 15px;
            }
            
            .content {
                padding: 20px 15px;
            }
            
            .word-card {
                padding: 20px 15px;
            }
            
            .chinese-info {
                font-size: 1.6em;
            }
            
            .pronounce-info {
                font-size: 1.1em;
            }
        }
    </style>
</head>
<body>
    <button class="back-home" onclick="window.location.href = '/index.html';">â† è¿”å›é¦–é¡µ</button>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ è‹±è¯­å•è¯é»˜å†™</h1>
            <p>æ ¹æ®ä¸­æ–‡é‡Šä¹‰é»˜å†™è‹±æ–‡å•è¯</p>
        </div>
        
        <div class="control-panel">
            <div class="range-inputs">
                <span class="range-label">å•è¯èŒƒå›´ï¼š</span>
                <div class="input-group">
                    <input 
                        type="number" 
                        id="startIndexInput" 
                        class="number-input" 
                        placeholder="èµ·å§‹ç¼–å·" 
                        min="0" 
                        value="1"
                    >
                    <input 
                        type="number" 
                        id="endIndexInput" 
                        class="number-input" 
                        placeholder="ç»“æŸç¼–å·" 
                        min="1" 
                        value="10"
                    >
                </div>
            </div>
            <button id="loadWordsBtn" class="btn btn-primary">
                <span>ğŸ“¥ åŠ è½½å•è¯</span>
            </button>
        </div>
        
        <div class="content">
            <div class="stats">
                <div class="stat-item">
                    <span class="stat-value" id="correctCount">0</span>
                    <span>æ­£ç¡®</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="totalCount">0</span>
                    <span>æ€»æ•°</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="accuracy">0%</span>
                    <span>å‡†ç¡®ç‡</span>
                </div>
            </div>
            
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            
            <div id="wordCard" class="word-card">
                <div class="loading">è¯·è¾“å…¥å•è¯èŒƒå›´å¹¶ç‚¹å‡»åŠ è½½</div>
            </div>
            
            <div class="user-input-section">
                <input 
                    type="text" 
                    id="userInput" 
                    class="user-input" 
                    placeholder="åœ¨è¿™é‡Œè¾“å…¥è‹±æ–‡å•è¯..."
                    autocomplete="off"
                >
                <div class="hint">æŒ‰ Enter é”®å¿«é€Ÿæäº¤ç­”æ¡ˆ</div>
            </div>
            
            <div id="validationResult" class="validation-result"></div>
            
            <div class="buttons">
                <div class="button-group">
                    <button id="prevWordBtn" class="btn btn-secondary">
                        <span>â—€ ä¸Šä¸€è¯</span>
                    </button>
                    <button id="toggleWordBtn" class="btn btn-info">
                        <span>ğŸ‘ï¸ æ˜¾ç¤ºç­”æ¡ˆ</span>
                    </button>
                    <button id="validateBtn" class="btn btn-primary">
                        <span>âœ“ æ ¡éªŒ</span>
                    </button>
                </div>
                <button id="nextWordBtn" class="btn btn-secondary">
                    <span>ä¸‹ä¸€è¯ â–¶</span>
                </button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
            <div id="bookInfo" class="book-info"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startIndexInput = document.getElementById('startIndexInput');
            const endIndexInput = document.getElementById('endIndexInput');
            const loadWordsBtn = document.getElementById('loadWordsBtn');
            const wordCard = document.getElementById('wordCard');
            const userInput = document.getElementById('userInput');
            const prevWordBtn = document.getElementById('prevWordBtn');
            const toggleWordBtn = document.getElementById('toggleWordBtn');
            const validateBtn = document.getElementById('validateBtn');
            const nextWordBtn = document.getElementById('nextWordBtn');
            const statusMessage = document.getElementById('statusMessage');
            const bookInfo = document.getElementById('bookInfo');
            const validationResult = document.getElementById('validationResult');
            const correctCountEl = document.getElementById('correctCount');
            const totalCountEl = document.getElementById('totalCount');
            const accuracyEl = document.getElementById('accuracy');
            const progressBar = document.getElementById('progressBar');
            
            let words = [];
            let currentIndex = 0;
            let currentWord = null;
            let wordVisible = false;
            let correctCount = 0;
            let totalAttempts = 0;

            // åŠ è½½å•è¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            loadWordsBtn.addEventListener('click', loadWords);
            
            // å›è½¦é”®æ”¯æŒ
            startIndexInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadWords();
                }
            });
            
            endIndexInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadWords();
                }
            });
            
            // è¾“å…¥æ¡†å›è½¦é”®æäº¤
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    validateBtn.click();
                }
            });
            
            // æ˜¾ç¤º/éšè—å•è¯
            toggleWordBtn.addEventListener('click', function() {
                const wordElement = document.querySelector('.word-info');
                wordVisible = !wordVisible;
                
                if (wordVisible) {
                    wordElement.classList.add('show');
                    toggleWordBtn.innerHTML = '<span>ğŸ™ˆ éšè—ç­”æ¡ˆ</span>';
                } else {
                    wordElement.classList.remove('show');
                    toggleWordBtn.innerHTML = '<span>ğŸ‘ï¸ æ˜¾ç¤ºç­”æ¡ˆ</span>';
                }
            });
            
            // ä¸Šä¸€è¯æŒ‰é’®
            prevWordBtn.addEventListener('click', function() {
                if (words.length === 0) return;
                
                currentIndex = (currentIndex - 1 + words.length) % words.length;
                renderCurrentWord();
                userInput.value = '';
                userInput.focus();
                hideValidationResult();
                // é‡ç½®å•è¯æ˜¾ç¤ºçŠ¶æ€
                wordVisible = false;
                toggleWordBtn.innerHTML = '<span>ğŸ‘ï¸ æ˜¾ç¤ºç­”æ¡ˆ</span>';
            });
            
            // æ ¡éªŒæŒ‰é’®
            validateBtn.addEventListener('click', function() {
                if (!currentWord) return;
                
                const userText = userInput.value.trim().toLowerCase();
                const correctText = currentWord.word.toLowerCase();
                
                if (userText === '') {
                    showStatus('è¯·è¾“å…¥å•è¯åå†æ ¡éªŒ', 'error');
                    return;
                }
                
                totalAttempts++;
                validateWord(userText, correctText);
            });
            
            // ä¸‹ä¸€è¯æŒ‰é’®
            nextWordBtn.addEventListener('click', function() {
                if (words.length === 0) return;
                
                currentIndex = (currentIndex + 1) % words.length;
                renderCurrentWord();
                userInput.value = '';
                userInput.focus();
                hideValidationResult();
                // é‡ç½®å•è¯æ˜¾ç¤ºçŠ¶æ€
                wordVisible = false;
                toggleWordBtn.innerHTML = '<span>ğŸ‘ï¸ æ˜¾ç¤ºç­”æ¡ˆ</span>';
            });
            
            // åŠ è½½å•è¯å‡½æ•°
            function loadWords() {
                const startIndex = parseInt(startIndexInput.value);
                const endIndex = parseInt(endIndexInput.value);
                
                if (isNaN(startIndex) || startIndex < 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„èµ·å§‹ç¼–å·ï¼ˆâ‰¥0ï¼‰');
                    return;
                }
                
                if (isNaN(endIndex) || endIndex <= startIndex) {
                    alert('ç»“æŸç¼–å·å¿…é¡»å¤§äºèµ·å§‹ç¼–å·');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                wordCard.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½å•è¯æ•°æ®...</div>';
                hideStatus();
                hideValidationResult();
                
                // æ„å»ºAPI URL
                const url = `http://localhost:8080/english/worddictation?start=${startIndex}&end=${endIndex}`;
                
                // ä»åç«¯APIè·å–æ•°æ®
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTPé”™è¯¯! çŠ¶æ€ç : ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.code !== 1 || !data.data || data.data.length === 0) {
                            wordCard.innerHTML = '<div class="error">æ²¡æœ‰æ‰¾åˆ°å•è¯æ•°æ®</div>';
                            words = [];
                            return;
                        }
                        
                        words = data.data;
                        currentIndex = 0;
                        correctCount = 0;
                        totalAttempts = 0;
                        updateStats();
                        renderCurrentWord();
                    })
                    .catch(error => {
                        console.error('è·å–æ•°æ®å¤±è´¥:', error);
                        wordCard.innerHTML = `
                            <div class="error">
                                <p>æ•°æ®åŠ è½½å¤±è´¥: ${error.message}</p>
                                <p>è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨</p>
                            </div>
                        `;
                        words = [];
                    });
            }
            
            // æ¸²æŸ“å½“å‰å•è¯
            function renderCurrentWord() {
                if (words.length === 0) return;
                
                const word = words[currentIndex];
                currentWord = word;
                
                wordCard.innerHTML = `
                    <div class="word-count-info">å…± ${words.length} ä¸ªå•è¯</div>
                    <div class="index-info">ç¬¬ ${currentIndex + 1} / ${words.length} ä¸ªå•è¯</div>
                    <div class="chinese-info">${word.chinese}</div>
                    <div class="pronounce-info">${word.pronounce}</div>
                    <div class="frequency">å‡ºç° ${word.times} æ¬¡</div>
                    <div class="word-info">${word.word}</div>
                `;
                
                // é‡ç½®å•è¯æ˜¾ç¤ºçŠ¶æ€
                wordVisible = false;
                toggleWordBtn.innerHTML = '<span>ğŸ‘ï¸ æ˜¾ç¤ºç­”æ¡ˆ</span>';
                
                // æ›´æ–°è¿›åº¦æ¡
                progressBar.style.width = `${((currentIndex + 1) / words.length) * 100}%`;
                
                // éšè—çŠ¶æ€æ¶ˆæ¯
                hideStatus();
                
                // è‡ªåŠ¨èšç„¦è¾“å…¥æ¡†
                setTimeout(() => {
                    userInput.focus();
                }, 100);
            }
            
            // æ ¡éªŒå•è¯
            function validateWord(userText, correctText) {
                if (userText === correctText) {
                    correctCount++;
                    validationResult.innerHTML = `
                        <div class="validation-correct">
                            <strong>âœ“ æ­£ç¡®ï¼</strong> ä½ è¾“å…¥çš„å•è¯å®Œå…¨æ­£ç¡®ã€‚
                        </div>
                    `;
                    validationResult.className = 'validation-result validation-correct';
                    
                    // è‡ªåŠ¨è·³è½¬åˆ°ä¸‹ä¸€ä¸ªå•è¯
                    setTimeout(() => {
                        if (currentIndex < words.length - 1) {
                            nextWordBtn.click();
                        }
                    }, 1000);
                } else {
                    validationResult.innerHTML = `
                        <div class="validation-incorrect">
                            <strong>âœ— é”™è¯¯</strong>
                            <div style="margin-top: 10px;">ä½ è¾“å…¥çš„æ˜¯: <strong>${userText}</strong></div>
                            <div style="margin-top: 10px;">æ­£ç¡®ç­”æ¡ˆæ˜¯: <strong>${correctText}</strong></div>
                        </div>
                    `;
                    validationResult.className = 'validation-result validation-incorrect';
                }
                
                updateStats();
            }
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            function updateStats() {
                correctCountEl.textContent = correctCount;
                totalCountEl.textContent = totalAttempts;
                const accuracy = totalAttempts > 0 ? Math.round((correctCount / totalAttempts) * 100) : 0;
                accuracyEl.textContent = `${accuracy}%`;
            }
            
            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(type === 'success' ? 'status-success' : 'status-error');
                
                // 5ç§’åè‡ªåŠ¨éšè—
                setTimeout(hideStatus, 5000);
            }
            
            // éšè—çŠ¶æ€æ¶ˆæ¯
            function hideStatus() {
                statusMessage.className = 'status-message';
                statusMessage.textContent = '';
            }
            
            // éšè—æ ¡éªŒç»“æœ
            function hideValidationResult() {
                validationResult.className = 'validation-result';
                validationResult.innerHTML = '';
            }
        });
    </script>
</body>
</html>