<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­è¯æ±‡å­¦ä¹ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        .back-home {
            position: fixed;
            top: 16px;
            left: 16px;
            padding: 6px 14px;
            border-radius: 999px;
            border: none;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            font-size: 0.9em;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .back-home:hover {
            background: #fff;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 550px;
            width: 100%;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 0.9em;
            opacity: 0.9;
        }
        
        .control-panel {
            padding: 20px;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
        }
        
        .number-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #4facfe;
            border-radius: 8px;
            font-size: 1em;
            outline: none;
        }
        
        .number-input:focus {
            border-color: #00f2fe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.2);
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 0 0 auto;
        }
        
        .btn-primary {
            background: #4facfe;
            color: white;
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-success {
            background: #28a745;
            color: white;
        }
        
        .btn-danger {
            background: #dc3545;
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .content {
            padding: 30px;
            text-align: center;
        }
        
        .word-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin-bottom: 30px;
            min-height: 250px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .word-info {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        
        .pronounce {
            color: #666;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .frequency {
            background: #4facfe;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 15px;
        }
        
        .chinese {
            color: #2c3e50;
            font-size: 1.1em;
            line-height: 1.6;
            margin-top: 15px;
            padding: 15px;
            background: rgba(79, 172, 254, 0.1);
            border-radius: 8px;
            border-left: 4px solid #4facfe;
            opacity: 0;
            height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .chinese.show {
            opacity: 1;
            height: auto;
            padding: 15px;
        }
        
        .buttons {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-top: 10px;
            gap: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }
        
        .error {
            text-align: center;
            padding: 50px;
            color: #e74c3c;
            font-size: 1.2em;
        }
        
        .index-info {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .word-count-info {
            color: #28a745;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.9em;
            display: none;
        }
        
        .status-success {
            background-color: #d4edda;
            color: #155724;
            display: block;
        }
        
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            display: block;
        }
        
        .book-info {
            margin-top: 10px;
            font-size: 0.9em;
            color: #6c757d;
            font-style: italic;
        }
    </style>
</head>
<body>
    <button class="back-home" onclick="window.location.href = '/index.html';">â† è¿”å›é¦–é¡µ</button>
    <div class="container">
        <div class="header">
            <h1>ğŸ“š è‹±è¯­è¯æ±‡å­¦ä¹ </h1>
            <p>æŒæ¡é«˜é¢‘è¯æ±‡ï¼Œæå‡è‹±è¯­èƒ½åŠ›</p>
        </div>
        
        <div class="control-panel">
            <div class="input-group">
                <input 
                    type="number" 
                    id="startIndexInput" 
                    class="number-input" 
                    placeholder="èµ·å§‹ç¼–å·" 
                    min="0" 
                    value="0"
                >
                <input 
                    type="number" 
                    id="endIndexInput" 
                    class="number-input" 
                    placeholder="ç»“æŸç¼–å·" 
                    min="1" 
                    value="10"
                >
            </div>
            <button id="loadWordsBtn" class="btn btn-primary">åŠ è½½å•è¯</button>
        </div>
        
        <div class="content">
            <div id="wordCard" class="word-card">
                <div class="loading">è¯·è¾“å…¥å•è¯èŒƒå›´å¹¶ç‚¹å‡»åŠ è½½</div>
            </div>
            
            <div class="buttons">
                <div class="button-group">
                    <button id="showChineseBtn" class="btn btn-primary">æ˜¾ç¤ºä¸­æ–‡</button>
                    <button id="addToCollectionBtn" class="btn btn-success">åŠ å…¥å­¦ä¹ </button>
                    <button id="removeFromCollectionBtn" class="btn btn-danger">ç§»é™¤å•è¯</button>
                </div>
                <button id="nextWordBtn" class="btn btn-secondary">ä¸‹ä¸€ä¸ª</button>
            </div>
            
            <div id="statusMessage" class="status-message"></div>
            <div id="bookInfo" class="book-info"></div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const startIndexInput = document.getElementById('startIndexInput');
            const endIndexInput = document.getElementById('endIndexInput');
            const loadWordsBtn = document.getElementById('loadWordsBtn');
            const wordCard = document.getElementById('wordCard');
            const showChineseBtn = document.getElementById('showChineseBtn');
            const addToCollectionBtn = document.getElementById('addToCollectionBtn');
            const removeFromCollectionBtn = document.getElementById('removeFromCollectionBtn');
            const nextWordBtn = document.getElementById('nextWordBtn');
            const statusMessage = document.getElementById('statusMessage');
            const bookInfo = document.getElementById('bookInfo');
            
            let words = [];
            let currentIndex = 0;
            let chineseVisible = false;
            let currentWord = null;
            let currentBookname = null;

            // é¡µé¢åŠ è½½æ—¶è·å–ä¹¦æœ¬åç§°
            const urlParams = new URLSearchParams(window.location.search);
            // currentBookname = urlParams.get('bookname');
            currentBookname = 'englishword4420';
            
            // æ ¹æ®ä¹¦æœ¬åç§°æ˜¾ç¤º/éšè—æŒ‰é’®
            if (currentBookname === 'againenglishword') {
                addToCollectionBtn.style.display = 'none';
                removeFromCollectionBtn.style.display = 'block';
                bookInfo.textContent = `å½“å‰ä¹¦æœ¬: ${currentBookname} (ç®¡ç†å‘˜æ¨¡å¼)`;
            } else {
                addToCollectionBtn.style.display = 'block';
                removeFromCollectionBtn.style.display = 'none';
                if (currentBookname) {
                    bookInfo.textContent = `å½“å‰ä¹¦æœ¬: ${currentBookname}`;
                }
            }

            // åŠ è½½å•è¯æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            loadWordsBtn.addEventListener('click', loadWords);
            
            // å›è½¦é”®æ”¯æŒ
            startIndexInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadWords();
                }
            });
            
            endIndexInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadWords();
                }
            });
            
            // æ˜¾ç¤º/éšè—ä¸­æ–‡é‡Šä¹‰
            showChineseBtn.addEventListener('click', function() {
                const chineseElement = document.querySelector('.chinese');
                chineseVisible = !chineseVisible;
                
                if (chineseVisible) {
                    chineseElement.classList.add('show');
                    showChineseBtn.textContent = 'éšè—ä¸­æ–‡';
                } else {
                    chineseElement.classList.remove('show');
                    showChineseBtn.textContent = 'æ˜¾ç¤ºä¸­æ–‡';
                }
            });
            
            // æ·»åŠ åˆ°å­¦ä¹ é›†
            addToCollectionBtn.addEventListener('click', function() {
                if (!currentWord) return;
                
                // å‡†å¤‡è¯·æ±‚æ•°æ®
                const requestData = {
                    bookname: currentBookname,
                    id: currentWord.id,
                    word: currentWord.word,
                    chinese: currentWord.chinese,
                    pronounce: currentWord.pronounce,
                    times: currentWord.times
                };
                
                // å‘é€POSTè¯·æ±‚
                fetch('http://localhost:8080/english/finalAdd', {
                // fetch('http://localhost:8080/english/finalAdd', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.code === 1) {
                        showStatus('æˆåŠŸåŠ å…¥å­¦ä¹ é›†!', 'success');
                    } else {
                        showStatus('æ“ä½œå¤±è´¥: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('æ·»åŠ åˆ°å­¦ä¹ é›†å¤±è´¥:', error);
                    showStatus('æ·»åŠ åˆ°å­¦ä¹ é›†å¤±è´¥: ' + error.message, 'error');
                });
            });
            
            // ä»å­¦ä¹ é›†ç§»é™¤
            removeFromCollectionBtn.addEventListener('click', function() {
                if (!currentWord) return;
                
                // å‡†å¤‡è¯·æ±‚æ•°æ®
                const requestData = {
                    bookname: currentBookname,
                    id: currentWord.id,
                    word: currentWord.word,
                    chinese: currentWord.chinese,
                    pronounce: currentWord.pronounce,
                    times: currentWord.times
                };
                
                // å‘é€POSTè¯·æ±‚
                // fetch('http://localhost:8080/english/remove', {
                fetch('http://localhost:8080/english/remove', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.code === 1) {
                        showStatus('æˆåŠŸä»å­¦ä¹ é›†ç§»é™¤!', 'success');
                        
                        // ä»å½“å‰å•è¯åˆ—è¡¨ä¸­ç§»é™¤è¯¥å•è¯
                        words = words.filter(word => word.id !== currentWord.id);
                        
                        // æ›´æ–°å•è¯æ€»æ•°æ˜¾ç¤º
                        const wordCountInfo = document.querySelector('.word-count-info');
                        if (wordCountInfo) {
                            wordCountInfo.textContent = `å…± ${words.length} ä¸ªå•è¯`;
                        }
                        
                        // å¦‚æœè¿˜æœ‰å•è¯ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ª
                        if (words.length > 0) {
                            // å¦‚æœå½“å‰æ˜¯æœ€åä¸€ä¸ªå•è¯ï¼Œå›åˆ°ç¬¬ä¸€ä¸ª
                            if (currentIndex >= words.length) {
                                currentIndex = 0;
                            }
                            
                            // æ¸²æŸ“ä¸‹ä¸€ä¸ªå•è¯
                            renderCurrentWord();
                            
                            // éšè—ä¸­æ–‡é‡Šä¹‰
                            chineseVisible = false;
                            showChineseBtn.textContent = 'æ˜¾ç¤ºä¸­æ–‡';
                        } else {
                            // å¦‚æœæ²¡æœ‰å•è¯äº†ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯
                            wordCard.innerHTML = '<div class="error">å½“å‰èŒƒå›´æ²¡æœ‰æ›´å¤šå•è¯äº†</div>';
                        }
                    } else {
                        showStatus('æ“ä½œå¤±è´¥: ' + data.message, 'error');
                    }
                })
                .catch(error => {
                    console.error('ä»å­¦ä¹ é›†ç§»é™¤å¤±è´¥:', error);
                    showStatus('ä»å­¦ä¹ é›†ç§»é™¤å¤±è´¥: ' + error.message, 'error');
                });
            });
            
            // ä¸‹ä¸€ä¸ªå•è¯
            nextWordBtn.addEventListener('click', function() {
                if (words.length === 0) return;
                
                currentIndex = (currentIndex + 1) % words.length;
                renderCurrentWord();
                // éšè—ä¸­æ–‡é‡Šä¹‰
                chineseVisible = false;
                showChineseBtn.textContent = 'æ˜¾ç¤ºä¸­æ–‡';
            });
            
            // åŠ è½½å•è¯å‡½æ•°
            function loadWords() {
                const startIndex = parseInt(startIndexInput.value);
                const endIndex = parseInt(endIndexInput.value);
                
                if (isNaN(startIndex) || startIndex < 0) {
                    alert('è¯·è¾“å…¥æœ‰æ•ˆçš„èµ·å§‹ç¼–å·ï¼ˆâ‰¥0ï¼‰');
                    return;
                }
                
                if (isNaN(endIndex) || endIndex <= startIndex) {
                    alert('ç»“æŸç¼–å·å¿…é¡»å¤§äºèµ·å§‹ç¼–å·');
                    return;
                }
                
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                wordCard.innerHTML = '<div class="loading">æ­£åœ¨åŠ è½½è¯æ±‡æ•°æ®...</div>';
                hideStatus();
                
                // æ„å»ºå¸¦å‚æ•°çš„URL
                // let url = `http://localhost:8080/english/list?start=${startIndex}&end=${endIndex}`;
                let url = `http://localhost:8080/english/list?start=${startIndex}&end=${endIndex}`;
                if (currentBookname) {
                    url += `&bookname=${encodeURIComponent(currentBookname)}`;
                }
                
                fetch(url)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.code !== 1 || !data.data || data.data.length === 0) {
                            wordCard.innerHTML = '<div class="error">æš‚æ— è¯æ±‡æ•°æ®</div>';
                            words = [];
                            return;
                        }
                        
                        words = data.data;
                        currentIndex = 0;
                        renderCurrentWord();
                    })
                    .catch(error => {
                        console.error('è·å–æ•°æ®å¤±è´¥:', error);
                        wordCard.innerHTML = `
                            <æé€Ÿæ¨¡å¼div class="error">
                                <p>æ•°æ®åŠ è½½å¤±è´¥: ${error.message}</p>
                                <p>è¯·æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å·²å¯åŠ¨</p>
                            </div>
                        `;
                        words = [];
                    });
            }
            
            // æ¸²æŸ“å½“å‰å•è¯
            function renderCurrentWord() {
                if (words.length === 0) return;
                
                const word = words[currentIndex];
                currentWord = word; // ä¿å­˜å½“å‰å•è¯å¯¹è±¡
                
                wordCard.innerHTML = `
                    <div class="word-count-info">å…± ${words.length} ä¸ªå•è¯</div>
                    <div class="index-info">ç¬¬ ${currentIndex + 1} / ${words.length} ä¸ªå•è¯</div>
                    <div class="word-info">${word.word}</div>
                    <div class="pronounce">${word.pronounce}</div>
                    <div class="frequency">å‡ºç° ${word.times} æ¬¡</div>
                    <div class="chinese">${word.chinese}</div>
                `;
                
                // éšè—çŠ¶æ€æ¶ˆæ¯
                hideStatus();
            }
            
            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            function showStatus(message, type) {
                statusMessage.textContent = message;
                statusMessage.className = 'status-message';
                statusMessage.classList.add(type === 'success' ? 'status-success' : 'status-error');
                
                // 5ç§’åè‡ªåŠ¨éšè—
                setTimeout(hideStatus, 5000);
            }
            
            // éšè—çŠ¶æ€æ¶ˆæ¯
            function hideStatus() {
                statusMessage.className = 'status-message';
                statusMessage.textContent = '';
            }
        });
    </script>
</body>
</html>