[6 tools called]

### 英语学习系统接口文档

> 后端技术栈：Spring Boot  
> 统一返回结构：`Result { code: 1 成功，0 失败, msg: 错误信息, data: 实际数据 }`  

---

## 一、现有接口整理

### 1. 通用说明

- **基础 URL**：`http://localhost:8080`
- **返回统一结构**

```json
{
  "code": 1,
  "msg": null,
  "data": {}
}
```

- **成功**：`code = 1`，`data` 为业务数据  
- **失败**：`code = 0`，`msg` 为错误信息  

---

### 2. 词汇 / 句子相关（`/english`）

#### 2.1 获取单词列表（按范围 + 课本）

- **URL**：`GET /english/list`
- **描述**：按编号区间和课本名称获取单词列表（主要用于普通浏览、游戏等）
- **请求参数（query）**：

| 参数名    | 类型   | 必填 | 说明                         |
|----------|--------|------|------------------------------|
| start    | string | 是   | 起始编号（闭区间）          |
| end      | string | 是   | 结束编号（开区间/闭区间，按实现） |
| bookname | string | 否   | 课本名称，如 `englishword4420` |

- **响应示例**

```json
{
  "code": 1,
  "data": [
    {
      "id": 1,
      "word": "ability",
      "chinese": "能力",
      "pronounce": "[əˈbɪləti]",
      "times": 12
      // 其他字段视 Englishs 实体而定
    }
  ]
}
```

---

#### 2.2 背诵单词列表（与 2.1 相同逻辑）

- **URL**：`GET /english/recite`
- **描述**：用于背诵模式，当前实现与 `/english/list` 共用逻辑
- **请求参数**：同 2.1
- **响应**：同 2.1

---

#### 2.3 加入“再次学习”单词集

- **URL**：`POST /english/add`
- **描述**：将单词加入“再次学习”表（例如 againenglishword）
- **请求体（JSON）**：`AddRequest`

```json
{
  "bookname": "englishword4420",
  "id": 123,
  "word": "ability",
  "chinese": "能力",
  "pronounce": "[əˈbɪləti]",
  "times": 12
}
```

- **响应**：

```json
{ "code": 1 }
```

---

#### 2.4 加入“最终学习集”（最终背诵清单）

- **URL**：`POST /english/finalAdd`
- **描述**：将单词加入最终学习集合，用于 `finally.html` 中的背诵
- **请求体**：同 2.3
- **响应**：同 2.3

---

#### 2.5 从再次 / 最终学习集中移除单词

- **URL**：`POST /english/remove`
- **描述**：从对应学习集中移除一个单词
- **请求体**：同 2.3
- **响应**：

```json
{ "code": 1 }
```

---

#### 2.6 获取句子列表（默写训练）

- **URL**：`GET /english/sentence`
- **描述**：获取指定编号区间的英文句子列表
- **请求参数**

| 参数名 | 类型   | 必填 | 说明     |
|--------|--------|------|----------|
| start  | string | 是   | 起始编号 |
| end    | string | 是   | 结束编号 |

- **响应示例**

```json
{
  "code": 1,
  "data": [
    {
      "id": 1,
      "sentence": "This is an example sentence.",
      "chinese": "这是一个例句。"
    }
  ]
}
```

---

#### 2.7 获取单词默写列表

- **URL**：`GET /english/worddictation`
- **描述**：目前固定从课本 `englishword575` 中取词汇做单词默写
- **请求参数**

| 参数名 | 类型   | 必填 | 说明     |
|--------|--------|------|----------|
| start  | string | 是   | 起始编号 |
| end    | string | 是   | 结束编号 |

- **响应**：同 2.1 中 `Englishs` 列表

---

### 3. 课本列表 / 课本校验（`/list`）

#### 3.1 获取所有课本名称

- **URL**：`GET /list`
- **描述**：用于首页 / 课本选择页展示所有可用课本
- **响应示例**

```json
{
  "code": 1,
  "data": [
    "englishword4420",
    "EnglishWord-576",
    "EngloshWord-200"
  ]
}
```

---

#### 3.2 校验课本是否存在

- **URL**：`GET /list/{bookName}`
- **路径参数**

| 参数名   | 说明     |
|----------|----------|
| bookName | 课本名称 |

- **响应示例**

```json
{
  "code": 1,
  "data": true
}
```

或

```json
{
  "code": 0,
  "msg": "课本不存在"
}
```

---

### 4. 知识积累本（`/jotting`）

#### 4.1 获取知识列表（分页）

- **URL**：`GET /jotting/list`
- **请求参数**

| 参数名 | 类型    | 必填 | 说明           |
|--------|---------|------|----------------|
| page   | integer | 是   | 页码，从 1 开始 |
| size   | integer | 是   | 每页条数       |

- **响应示例**

```json
{
  "code": 1,
  "data": {
    "total": 120,
    "page": 1,
    "size": 10,
    "list": [
      {
        "id": 1,
        "english": "break down",
        "chinese": "分解；故障",
        "reviewed": false,
        "createTime": "2025-12-02 10:00:00"
      }
    ]
  }
}
```

---

#### 4.2 新增知识记录

- **URL**：`POST /jotting/add`
- **请求体**

```json
{
  "english": "break down",
  "chinese": "分解；故障",
  "reviewed": false
}
```

- **响应**：`{ "code": 1 }`

---

#### 4.3 更新知识记录

- **URL**：`PUT /jotting/update`
- **请求体**

```json
{
  "id": 1,
  "english": "break down",
  "chinese": "分解；出故障",
  "reviewed": true
}
```

- **响应**：`{ "code": 1 }`

---

#### 4.4 删除单条知识记录

- **URL**：`DELETE /jotting/delete/{id}`
- **路径参数**：`id` – 记录 ID
- **响应**：`{ "code": 1 }`

---

#### 4.5 批量删除知识记录

- **URL**：`POST /jotting/batchDelete`
- **请求体**

```json
["1", "2", "3"]
```

- **响应**：`{ "code": 1 }`

---

### 5. 学习记录与复习（`/study`）

#### 5.1 添加学习记录

- **URL**：`POST /study/record`
- **描述**：向指定记录表写入一条学习记录（用于“学习记录清单”）
- **请求参数（query）**

| 参数名 | 类型   | 必填 | 说明                          |
|--------|--------|------|-------------------------------|
| table  | string | 是   | 目标表名，如 `daily_record` 等 |

- **请求体**

```json
{
  "record": "今日完成 20 个新单词"
}
```

- **响应**：`{ "code": 1 }`

---

#### 5.2 获取今日需要复习的记录

- **URL**：`GET /study/list`
- **请求参数**

| 参数名 | 类型   | 必填 | 说明                          |
|--------|--------|------|-------------------------------|
| table  | string | 是   | 目标表名，如 `study_record` 等 |

- **响应示例**

```json
{
  "code": 1,
  "data": [
    {
      "id": 1,
      "record": "复习英语四级高频词",
      "createTime": "2025-12-01 09:00:00",
      "toDate": 3,
      "alreadyReviewed": 0
    }
  ]
}
```

---

#### 5.3 标记记录为已复习

- **URL**：`POST /study/mark`
- **请求参数（query）**

| 参数名 | 类型   | 必填 | 说明  |
|--------|--------|------|-------|
| table  | string | 是   | 表名 |

- **请求体**

```json
{
  "ids": ["1", "3", "5"]
}
```

- **响应**：`{ "code": 1 }`

---

### 6. AI 文章生成（`/article`）

#### 6.1 基于选定单词生成文章（SSE 流式）

- **URL**：`GET /article/generation`
- **描述**：使用 Spring AI（ChatClient）基于指定课本中某段单词生成英文文章，返回 **文本流（Server-Sent Events 或分段 HTML 文本）**
- **响应类型**：`text/html;charset=utf-8`
- **请求参数**

| 参数名    | 类型   | 必填 | 说明                                       |
|-----------|--------|------|--------------------------------------------|
| beginIndex | string | 是   | 起始单词编号                              |
| endIndex   | string | 是   | 结束单词编号                              |
| bookName   | string | 是   | 课本名称，如 `englishword4420`            |

- **响应**  
  浏览器端通过 `EventSource` 或 `fetch` 逐段接收服务器推送的内容，前端负责将文本拼接为完整文章。

---

## 二、建议新增 / 完善的接口（用于替代“写死”的数据）

> 以下接口尚未在代码中实现，是针对当前前端写死的数据（主页概览数据、任务进度、折线图等）设计的 **推荐接口规范**。  
> 实现时建议统一使用现有的 `Result` 返回结构。

---

### 1. 首页学习概览 / 仪表盘

#### 1.1 学习概览统计

- **URL**：`GET /dashboard/overview`
- **用途**：驱动首页顶部“今日学习时长、连续打卡天数、已掌握词汇量、本月目标完成率”等数据。
- **请求参数**

| 参数名 | 类型   | 必填 | 说明               |
|--------|--------|------|--------------------|
| userId | string | 否   | 用户 ID，当前可忽略或写死 |

- **响应示例**

```json
{
  "code": 1,
  "data": {
    "todayDurationMinutes": 35,
    "streakDays": 7,
    "masteredWords": 1260,
    "monthGoalCompletion": 54
  }
}
```

---

#### 1.2 今日任务进度（各功能模块）

- **URL**：`GET /dashboard/tasks/today`
- **用途**：替换首页“智能背词系统：12/20、词汇游戏中心：1/3”等写死的数据。
- **响应示例**

```json
{
  "code": 1,
  "data": {
    "wordStudy": { "done": 12, "total": 20 },      // 智能背词系统
    "gameCenter": { "done": 1, "total": 3 },       // 词汇游戏中心
    "sentenceDictation": { "done": 5, "total": 10 },// 句子默写训练
    "wordDictation": { "done": 8, "total": 15 },   // 单词默写训练
    "jotting": { "done": 3 },                      // 知识积累本：今日新增条数
    "article": { "done": 1 }                       // 今日生成文章数量
  }
}
```

- **实现建议**  
  - 可以基于 `study_record` / `daily_record` 等表中记录数量、背词记录表、文章生成日志表等统计。  
  - 若暂时没有对应表，可以先用简单配置表或 Redis 计数实现。

---

#### 1.3 最近 7 天学习趋势

- **URL**：`GET /dashboard/trend`
- **用途**：替换首页右侧黑色卡片中的“最近 7 天学习趋势”折线 / 柱状数据。
- **请求参数**

| 参数名 | 类型   | 必填 | 说明        |
|--------|--------|------|-------------|
| days   | int    | 否   | 统计天数，默认 7 |

- **响应示例**

```json
{
  "code": 1,
  "data": [
    { "date": "2025-11-26", "tasksCompleted": 6, "durationMinutes": 20 },
    { "date": "2025-11-27", "tasksCompleted": 8, "durationMinutes": 30 },
    { "date": "2025-11-28", "tasksCompleted": 5, "durationMinutes": 18 },
    { "date": "2025-11-29", "tasksCompleted": 9, "durationMinutes": 40 },
    { "date": "2025-11-30", "tasksCompleted": 7, "durationMinutes": 28 },
    { "date": "2025-12-01", "tasksCompleted": 10, "durationMinutes": 45 },
    { "date": "2025-12-02", "tasksCompleted": 12, "durationMinutes": 55 }
  ]
}
```

- **前端使用**  
  - `tasksCompleted` 可画折线 / 柱状图。  
  - `durationMinutes` 可作为次要指标用于 tooltip 展示。

---

### 2. 学习会话 / 计时上报（可选扩展）

当前“今日学习时长”“连续打卡天数”等完全写死，建议增加以下接口来支撑真实统计。

#### 2.1 上报一次学习会话

- **URL**：`POST /study/session`
- **用途**：前端在用户完成一次学习（如某个模块学完一轮）后上报本次学习时长和类型。
- **请求体**

```json
{
  "module": "wordStudy",      // wordStudy, gameCenter, sentenceDictation 等
  "durationMinutes": 15,
  "wordsLearned": 20,
  "userId": "default"
}
```

- **响应**

```json
{ "code": 1 }
```

- **实现建议**  
  - 表结构 `study_session(id, user_id, module, duration_minutes, words_learned, create_time)`。  
  - `/dashboard/overview` 与 `/dashboard/trend` 直接基于该表统计。

---

#### 2.2 获取模块级别统计（按课本）

- **URL**：`GET /stats/books/{bookName}`
- **用途**：未来用于展示每本词书的掌握进度（目前前端暂未用，但设计上有利于扩展）
- **路径参数**：`bookName` – 课本名称
- **响应示例**

```json
{
  "code": 1,
  "data": {
    "bookName": "englishword4420",
    "totalWords": 4420,
    "learnedWords": 1560,
    "reviewedWords": 800,
    "masteredWords": 420,
    "completionRate": 35
  }
}
```

---

### 3. 统一错误码与风格建议

- **错误场景**：  
  - 参数缺失 / 格式错误：`code = 0, msg = "参数错误：xxx"`  
  - 资源不存在：`code = 0, msg = "资源不存在"`  
  - 内部错误：`code = 0, msg = "服务器内部错误"`  

- **风格建议（已在新接口设计中采用）：**
  - 资源使用名词复数，如 `/dashboard/overview`、`/dashboard/trend`、`/study/sessions`。  
  - 使用 HTTP 动词表达操作语义：`GET` 查询、`POST` 创建、`PUT` 更新、`DELETE` 删除。  
  - 所有接口统一返回 `Result` 结构，方便前端统一处理。  
  - 路径用小写、`-` / 驼峰均可，目前项目已大量使用驼峰 query 参数，建议路径保持简洁。

---

如果你希望，我可以按上述第二部分的设计，直接在后端新增 `DashboardController` 和简单的内存/数据库实现，让首页的统计和折线图真正从接口获取，不再写死在前端。